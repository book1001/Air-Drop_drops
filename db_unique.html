<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Air–Drop</title>
  <style>
    @font-face {
      font-family: 'NeueHaasGroteskDisplayPro-Black';
      src: url('https://pancake.garden/0_font/NeueHaasGroteskDisplayPro-Black-tabular.woff') format('woff');
      src: url('https://pancake.garden/0_font/NeueHaasGroteskDisplayPro-Black-tabular.woff2') format('woff2');
    }
    body {
      background-color: rgb(236, 235, 121);
      font-family: 'NeueHaasGroteskDisplayPro-Black';
      cursor: none;
    }

    /* ::-webkit-scrollbar { 
      width: 0;
    } */

    p {
      margin-block-start: 0;
      margin-block-end: 0;
    }

    .entry {
      margin-bottom: 50px;
      padding: 10px;
    }
    
    .timestamp {
      text-decoration: line-through;
    }

    svg {
      max-width: 100%;
    }

    .floating {
        animation: floaty 2s ease-in-out infinite;
    }

    @keyframes floaty {
      0%   { transform: translateY(0px); }
      50%  { transform: translateY(-8px); }
      100% { transform: translateY(0px); }
    }

    .longitude {
      position: fixed;
      left: 50%;
      width: 350px;

      font-family: 'NeueHaasGroteskDisplayPro-Black';
      font-size: 80px;
      text-align: right;
      z-index: 5;
      pointer-events: none;
    }

    .long-T {
      top: -15px;
      -webkit-transform: translate(-50%, 0);
      -moz-transform: translate(-50%, 0);
      -ms-transform: translate(-50%, 0);
      -o-transform: translate(-50%, 0);
      transform: translate(-50%, 0);
    }

    .long-B {
      bottom: -15px;
      -webkit-transform: translate(-50%, 0) scale(-1);
      -moz-transform: translate(-50%, 0) scale(-1);
      -ms-transform: translate(-50%, 0) scale(-1);
      -o-transform: translate(-50%, 0) scale(-1);
      transform: translate(-50%, 0) scale(-1);
    }

    /* ---------------------------------------- */
    .latitude {
      position: fixed;
      top: 50%;
      height: 300px;

      font-family: 'NeueHaasGroteskDisplayPro-Black';
      font-size: 80px;
      text-align: right;
      z-index: 5;
      pointer-events: none;
    }

    .lat-L {
      left: -15px;
      writing-mode: vertical-rl;
      -webkit-transform: translate(0, calc(-50% - 30px)) scale(-1);
      -moz-transform: translate(0, calc(-50% - 30px)) scale(-1);
      -ms-transform: translate(0, calc(-50% - 30px)) scale(-1);
      -o-transform: translate(0, calc(-50% - 30px)) scale(-1);
      translate: translate(0, calc(-50% - 30px)) scale(-1);
    }

    .lat-R {
      right: -15px;
      writing-mode: vertical-rl;
      -webkit-transform: translate(0, calc(-50% - 30px));
      -moz-transform: translate(0, calc(-50% - 30px));
      -ms-transform: translate(0, calc(-50% - 30px));
      -o-transform: translate(0, calc(-50% - 30px));
      transform: translate(0, calc(-50% - 30px));
    }

    #content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* padding: 100px 0 0 0; */
      
      display: flex;
      flex-direction: column;
      align-items: center;
      
      font-family: 'NeueHaasGroteskDisplayPro-Black';
      font-size: 34px;
      text-align: center;
      
      overflow-x: hidden;
      overflow-y: auto;
      z-index: 2;
      /* backdrop-filter: blur(9px); */
    }
  </style>
</head>
<body>

  <!-- <div class="longitude long-T">120°05 </div>
  <div class="latitude lat-R">30°16</div>
  <div class="longitude long-B"> 120°05</div>
  <div class="latitude lat-L">30°16</div> -->
  
  <div id="content"></div>

  <script>
    fetch('data/db_unique.json')
      .then(response => response.json())
      .then(data => {
        const content = document.getElementById('content');
        const entries = Array.isArray(data) ? data : [data];

        // 이전에 본 SVG index를 localStorage에서 가져오기
        let seenIndices = JSON.parse(localStorage.getItem('seenIndices') || '[]');

        // 선택할 수 있는 인덱스 필터링
        const availableIndices = entries
          .map((_, i) => i)
          .filter(i => !seenIndices.includes(i));

        if (availableIndices.length === 0) {
          // 모든 항목을 다 본 경우 초기화
          seenIndices = [];
          localStorage.setItem('seenIndices', JSON.stringify(seenIndices));
          availableIndices.push(...entries.map((_, i) => i));
        }

        // 랜덤으로 하나 선택
        const randomIndex = availableIndices[Math.floor(Math.random() * availableIndices.length)];
        const entry = entries[randomIndex];

        // 선택된 항목을 seenIndices에 추가
        seenIndices.push(randomIndex);
        localStorage.setItem('seenIndices', JSON.stringify(seenIndices));

        const container = document.createElement('div');
        container.className = 'entry';

        // SVG 렌더링
        const svgWrapper = document.createElement('div');
        svgWrapper.innerHTML = entry.svg;
        container.appendChild(svgWrapper);

        // g 요소 순차 애니메이션
        const gElements = svgWrapper.querySelectorAll('g');
        gElements.forEach((g, index) => {
          g.classList.add('floating');
          g.style.animationDelay = `${index * 0.1}s`;
        });

        // 텍스트 정보 렌더링
        const timestampP = document.createElement('p');
        timestampP.textContent = `${entry.timestamp.date}  ${entry.timestamp.time}`;
        timestampP.classList.add('timestamp');
        container.appendChild(timestampP);

        const deletedP = document.createElement('p');
        deletedP.textContent = `${entry.deleted.date}  ${entry.deleted.time}`;
        container.appendChild(deletedP);

        const locationP = document.createElement('p');
        locationP.textContent = `${entry.location.longitude}° ${entry.location.latitude}°  `;
        container.appendChild(locationP);

        content.appendChild(container);
      })
      .catch(error => {
        console.error('Error loading JSON:', error);
      });
  </script>


</body>
</html>
