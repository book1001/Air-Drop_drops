<!DOCTYPE html>
<html>
<head>
  <meta charset="UTF-8">
  <title>Air–Drop</title>
  <style>
    @font-face {
      font-family: 'NeueHaasGroteskDisplayPro-Black';
      src: url('https://pancake.garden/0_font/NeueHaasGroteskDisplayPro-Black-tabular.woff') format('woff');
      src: url('https://pancake.garden/0_font/NeueHaasGroteskDisplayPro-Black-tabular.woff2') format('woff2');
    }
    body {
      background-color: rgb(236, 235, 121);
      font-family: 'NeueHaasGroteskDisplayPro-Black';
      /* cursor: none; */
    }

    /* ::-webkit-scrollbar { 
      width: 0;
    } */

    p {
      margin-block-start: 0;
      margin-block-end: 0;
    }

    .entry {
      margin-bottom: 50px;
      padding: 10px;
    }
    
    .timestamp {
      text-decoration: line-through;
    }

    svg {
      max-width: 100%;
    }

    .floating {
        animation: floaty 2s ease-in-out infinite;
    }

    @keyframes floaty {
      0%   { transform: translateY(0px); }
      50%  { transform: translateY(-8px); }
      100% { transform: translateY(0px); }
    }

    .longitude {
      position: fixed;
      left: 50%;
      width: 350px;

      font-family: 'NeueHaasGroteskDisplayPro-Black';
      font-size: 80px;
      text-align: right;
      z-index: 5;
      pointer-events: none;
    }

    .long-T {
      top: -15px;
      -webkit-transform: translate(-50%, 0);
      -moz-transform: translate(-50%, 0);
      -ms-transform: translate(-50%, 0);
      -o-transform: translate(-50%, 0);
      transform: translate(-50%, 0);
    }

    .long-B {
      bottom: -15px;
      -webkit-transform: translate(-50%, 0) scale(-1);
      -moz-transform: translate(-50%, 0) scale(-1);
      -ms-transform: translate(-50%, 0) scale(-1);
      -o-transform: translate(-50%, 0) scale(-1);
      transform: translate(-50%, 0) scale(-1);
    }

    /* ---------------------------------------- */
    .latitude {
      position: fixed;
      top: 50%;
      height: 300px;

      font-family: 'NeueHaasGroteskDisplayPro-Black';
      font-size: 80px;
      text-align: right;
      z-index: 5;
      pointer-events: none;
    }

    .lat-L {
      left: -15px;
      writing-mode: vertical-rl;
      -webkit-transform: translate(0, calc(-50% - 30px)) scale(-1);
      -moz-transform: translate(0, calc(-50% - 30px)) scale(-1);
      -ms-transform: translate(0, calc(-50% - 30px)) scale(-1);
      -o-transform: translate(0, calc(-50% - 30px)) scale(-1);
      translate: translate(0, calc(-50% - 30px)) scale(-1);
    }

    .lat-R {
      right: -15px;
      writing-mode: vertical-rl;
      -webkit-transform: translate(0, calc(-50% - 30px));
      -moz-transform: translate(0, calc(-50% - 30px));
      -ms-transform: translate(0, calc(-50% - 30px));
      -o-transform: translate(0, calc(-50% - 30px));
      transform: translate(0, calc(-50% - 30px));
    }

    #content {
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      /* padding: 100px 0 0 0; */
      
      display: flex;
      flex-direction: column;
      align-items: center;
      
      font-family: 'NeueHaasGroteskDisplayPro-Black';
      font-size: 34px;
      text-align: center;
      
      overflow-x: hidden;
      overflow-y: auto;
      z-index: 2;
      /* backdrop-filter: blur(9px); */
    }

    .count {
      font-size: 34px;
      pointer-events: none;
    }
  </style>
</head>
<body>

  <!-- <div class="longitude long-T">120°05 </div>
  <div class="latitude lat-R">30°16</div>
  <div class="longitude long-B"> 120°05</div>
  <div class="latitude lat-L">30°16</div> -->
  
  <div id="content"></div>

  <script>
    fetch('data/db_250501.json')
      .then(response => response.json())
      .then(data => {
        const content = document.getElementById('content');
  
        const entries = Array.isArray(data) ? data : [data];

        // JSON 항목 총 개수 표시용
        const countDisplay = document.createElement('p');
        countDisplay.textContent = `${entries.length}`;
        countDisplay.classList.add('count');
        countDisplay.style.fontWeight = 'bold';
        document.body.appendChild(countDisplay);
      
        const seenSVGs = new Set(); // 중복 SVG 추적용
  
        function formatLocation(location) {
          const lat = parseFloat(location.latitude);
          const lon = parseFloat(location.longitude);

          const latDirection = lat >= 0 ? 'N' : 'S';
          const lonDirection = lon >= 0 ? 'E' : 'W';

          const absLat = Math.abs(lat).toFixed(2);
          const absLon = Math.abs(lon).toFixed(2);

          return `${absLat}°${latDirection}, ${absLon}°${lonDirection}`;
        }

        entries.forEach(entry => {
          if (seenSVGs.has(entry.svg)) return; // 이미 본 svg면 건너뜀
          seenSVGs.add(entry.svg); // 새 svg는 기억해두기
  
          const container = document.createElement('p');
          container.className = 'entry';
  
          // // SVG 렌더링
          // const svgWrapper = document.createElement('div');
          // svgWrapper.innerHTML = entry.svg;
          // container.appendChild(svgWrapper);
  
          // // g요소 순차 애니메이션
          // const gElements = svgWrapper.querySelectorAll('g'); // 여기 수정
          // gElements.forEach((g, index) => {
          //   g.classList.add('floating');
          //   g.style.animationDelay = `${index * 0.1}s`;
          // });
  
          // 텍스트 정보 렌더링
          // const positionP = document.createElement('p');
          // positionP.textContent = `Position: ${entry.position.top} ${entry.position.left}`;
          // container.appendChild(positionP);
  
          const timestampP = document.createElement('span');
          timestampP.textContent = `Sent: ${entry.timestamp.date}, ${entry.timestamp.time}`;
          container.appendChild(timestampP);
          container.appendChild(document.createElement('br'));
  
          const deletedP = document.createElement('span');
          deletedP.textContent = `Received: ${entry.deleted.date}, ${entry.deleted.time}`;
          container.appendChild(deletedP);
          container.appendChild(document.createElement('br'));
  
          const locationP = document.createElement('span');
          locationP.textContent = `Location: ${formatLocation(entry.location)}`;
          container.appendChild(locationP);
  
          content.appendChild(container);
        });
      })
      .catch(error => {
        console.error('Error loading JSON:', error);
      });
  </script>

</body>
</html>
